{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///Users/admin/Desktop/%20aiCoding/MVP/game-deal-frontend/components/DealsPage.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useMemo } from \"react\";\nimport Image from \"next/image\";\nimport axios from \"axios\";\n\n// --- 1. 타입 정의 ---\ninterface Deal {\n  id: number;\n  platform: string;\n  title: string;\n  url: string;\n  regular_price: number;\n  sale_price: number;\n  discount_rate: number;\n  deal_type: \"GamePass\" | \"Epic\" | \"Sale\" | \"Free\";\n  image_url?: string;\n  xboxMeta?: { game_pass_tier: string; is_day_one: boolean };\n  epicMeta?: { is_free_to_keep: boolean };\n}\n\ninterface DealsPageProps {\n  title: string;\n  category: \"free\" | \"sale\" | \"sub\";\n}\n\nexport default function DealsPage({ title, category }: DealsPageProps) {\n  const [deals, setDeals] = useState<Deal[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [sortOrder, setSortOrder] = useState<\"az\" | \"newest\">(\"az\");\n\n  // --- 2. 데이터 로드 ---\n  useEffect(() => {\n    const fetchData = async () => {\n      setLoading(true);\n      try {\n        const [xboxRes, epicRes] = await Promise.allSettled([\n          axios.get(\"http://localhost:4000/api/v1/deals\", {\n            params: { platform: \"Xbox\", limit: 3000 },\n          }),\n          axios.get(\"http://localhost:4000/api/v1/deals\", {\n            params: { platform: \"Epic\", limit: 3000 },\n          }),\n        ]);\n\n        const xboxData =\n          xboxRes.status === \"fulfilled\" ? xboxRes.value.data.data : [];\n        const epicData =\n          epicRes.status === \"fulfilled\" ? epicRes.value.data.data : [];\n        const allDeals: Deal[] = [...xboxData, ...epicData];\n\n        // 카테고리별 필터링 로직\n        let targetDeals: Deal[] = [];\n        if (category === \"free\") {\n          // 무료 배포: GamePass 제외, 순수 무료(가격 0원) 또는 Epic Free Keep\n          targetDeals = allDeals.filter(\n            (d) =>\n              d.deal_type !== \"GamePass\" &&\n              (d.sale_price === 0 || d.epicMeta?.is_free_to_keep)\n          );\n        } else if (category === \"sale\") {\n          // 할인: 정가 > 판매가이고, 무료가 아니며, GamePass가 아닌 것\n          targetDeals = allDeals.filter(\n            (d) =>\n              d.deal_type !== \"GamePass\" &&\n              d.regular_price > d.sale_price &&\n              d.sale_price > 0\n          );\n        } else if (category === \"sub\") {\n          // 구독: deal_type이 GamePass인 것 또는 Xbox 플랫폼\n          targetDeals = allDeals.filter(\n            (d) => d.deal_type === \"GamePass\" || d.platform.includes(\"Xbox\")\n          );\n        }\n\n        setDeals(targetDeals);\n      } catch (error) {\n        console.error(\"데이터 로드 실패\", error);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchData();\n  }, [category]);\n\n  // --- 3. 검색 및 정렬 ---\n  const filteredDeals = useMemo(() => {\n    let result = deals.filter((deal) =>\n      deal.title.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    if (sortOrder === \"az\") {\n      result.sort((a, b) => {\n        const titleA = a.title;\n        const titleB = b.title;\n        const isKoA = /[가-힣]/.test(titleA.charAt(0));\n        const isKoB = /[가-힣]/.test(titleB.charAt(0));\n\n        if (isKoA === isKoB) {\n          return titleA.localeCompare(titleB, \"ko-KR\", { numeric: true });\n        }\n        return isKoA ? -1 : 1;\n      });\n    }\n    return result;\n  }, [deals, searchTerm, sortOrder]);\n\n  const getImageSrc = (deal: Deal) => deal.image_url || \"/default_thumb.png\";\n\n  // --- 4. 렌더링 헬퍼 ---\n\n  const renderPriceOrInfo = (deal: Deal) => {\n    if (deal.xboxMeta || deal.deal_type === \"GamePass\") {\n      return (\n        <div className=\"flex flex-col items-start gap-0.5\">\n          <span className=\"text-xs font-extrabold text-green-700 uppercase\">\n            {deal.xboxMeta?.game_pass_tier\n              ? deal.xboxMeta.game_pass_tier.replace(/,/g, \" · \")\n              : \"GAME PASS\"}\n          </span>\n          <span className=\"text-[10px] text-gray-500 truncate max-w-full\">\n            구독 서비스 포함\n          </span>\n        </div>\n      );\n    }\n    return (\n      <div className=\"flex flex-col items-start\">\n        {deal.regular_price > deal.sale_price && deal.regular_price > 0 && (\n          <span className=\"text-[10px] text-gray-400 line-through\">\n            ₩{deal.regular_price.toLocaleString()}\n          </span>\n        )}\n        <span className=\"text-blue-600 font-bold text-sm\">\n          {deal.sale_price === 0\n            ? \"무료\"\n            : `₩${deal.sale_price.toLocaleString()}`}\n        </span>\n      </div>\n    );\n  };\n\n  const renderBadges = (deal: Deal) => {\n    if (deal.xboxMeta?.is_day_one) {\n      return (\n        <span className=\"px-1.5 py-0.5 text-[9px] font-bold text-black bg-yellow-400 rounded\">\n          Day 1\n        </span>\n      );\n    }\n    if (deal.epicMeta?.is_free_to_keep) {\n      return (\n        <span className=\"px-1.5 py-0.5 text-[9px] font-bold text-white bg-blue-600 rounded\">\n          Free Keep\n        </span>\n      );\n    }\n    if (deal.deal_type !== \"GamePass\" && deal.discount_rate > 0) {\n      return (\n        <span className=\"px-1.5 py-0.5 text-[9px] font-bold text-white bg-red-600 rounded\">\n          -{deal.discount_rate}%\n        </span>\n      );\n    }\n    return null;\n  };\n\n  return (\n    // [수정] 배경색 적용을 위한 래퍼 추가 (bg-gray-50)\n    <div className=\"min-h-screen bg-gray-50\">\n      <main className=\"max-w-7xl mx-auto px-4 md:px-8 py-8\">\n        {/* --- 상단 컨트롤러 --- */}\n        <div className=\"flex flex-col md:flex-row justify-between items-end mb-8 gap-4\">\n          <div>\n            <h1 className=\"text-3xl font-extrabold text-gray-900 mb-2\">\n              {title}\n            </h1>\n            <p className=\"text-gray-500 text-sm\">\n              총{\" \"}\n              <span className=\"font-bold text-gray-900\">\n                {filteredDeals.length}\n              </span>\n              개의 게임을 찾았습니다.\n            </p>\n          </div>\n\n          <div className=\"flex flex-col sm:flex-row gap-3 w-full md:w-auto\">\n            <input\n              type=\"text\"\n              placeholder=\"게임 제목 검색...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"flex-1 md:w-64 px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gray-900 outline-none transition-shadow\"\n            />\n            <select\n              value={sortOrder}\n              onChange={(e: any) => setSortOrder(e.target.value)}\n              className=\"px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gray-900 outline-none bg-white cursor-pointer\"\n            >\n              <option value=\"az\">가나다순 (A-Z)</option>\n            </select>\n          </div>\n        </div>\n\n        {/* --- 메인 그리드 영역 --- */}\n        {loading ? (\n          <div className=\"flex justify-center py-32\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900\"></div>\n          </div>\n        ) : filteredDeals.length === 0 ? (\n          <div className=\"text-center py-32 border-2 border-dashed border-gray-200 rounded-xl bg-gray-50\">\n            <p className=\"text-gray-500\">조건에 맞는 게임이 없습니다.</p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-x-5 gap-y-8\">\n            {filteredDeals.map((deal) => (\n              <div\n                key={deal.id}\n                className=\"group bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-all duration-300 flex flex-col w-full\"\n              >\n                {/* 이미지 영역 */}\n                <div className=\"relative w-full aspect-[16/9] bg-gray-200\">\n                  <Image\n                    src={getImageSrc(deal)}\n                    alt={deal.title}\n                    fill\n                    className=\"object-cover group-hover:scale-105 transition-transform duration-300\"\n                    unoptimized\n                  />\n                  <div className=\"absolute top-2 left-2 bg-black/70 backdrop-blur-md text-white text-[9px] font-bold px-1.5 py-0.5 rounded uppercase\">\n                    {deal.platform.includes(\"Xbox\") ? \"Xbox\" : deal.platform}\n                  </div>\n                </div>\n\n                {/* 텍스트 정보 영역 */}\n                <div className=\"p-3 flex flex-col h-[140px]\">\n                  <h4 className=\"text-sm font-bold text-gray-900 leading-tight line-clamp-2 mb-1 h-10 group-hover:text-blue-600 transition-colors\">\n                    {deal.title}\n                  </h4>\n\n                  <div className=\"mt-auto\">\n                    <div className=\"mb-2 min-h-[40px] flex flex-col justify-end\">\n                      <div className=\"flex justify-between items-end w-full\">\n                        {renderPriceOrInfo(deal)}\n                        {renderBadges(deal)}\n                      </div>\n                    </div>\n\n                    <a\n                      href={deal.url}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"block w-full text-center bg-gray-100 hover:bg-gray-200 text-gray-800 text-xs font-bold py-1.5 rounded transition-colors\"\n                    >\n                      {deal.deal_type === \"GamePass\" || deal.xboxMeta\n                        ? \"플레이 하기\"\n                        : \"스토어 이동\"}\n                    </a>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </main>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}