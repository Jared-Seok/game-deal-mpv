{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///Users/admin/Desktop/%20aiCoding/MVP/game-deal-frontend/components/DealsPage.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useMemo } from \"react\";\nimport Image from \"next/image\";\nimport axios from \"axios\";\n\n// --- 1. 타입 정의 (메인 페이지와 동일하게 유지) ---\ninterface Deal {\n  id: number;\n  platform: string;\n  title: string;\n  url: string;\n  regular_price: number;\n  sale_price: number;\n  discount_rate: number;\n  deal_type: \"GamePass\" | \"Epic\" | \"Sale\" | \"Free\";\n  image_url?: string;\n  xboxMeta?: { game_pass_tier: string; is_day_one: boolean };\n  epicMeta?: { is_free_to_keep: boolean };\n}\n\ninterface DealsPageProps {\n  title: string;\n  category: \"free\" | \"sale\" | \"sub\";\n}\n\nexport default function DealsPage({ title, category }: DealsPageProps) {\n  const [deals, setDeals] = useState<Deal[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [sortOrder, setSortOrder] = useState<\"az\" | \"newest\">(\"az\");\n\n  // --- 2. 데이터 로드 ---\n  useEffect(() => {\n    const fetchData = async () => {\n      setLoading(true);\n      try {\n        // 모든 카탈로그(450개+)를 한 번에 불러오기 위해 limit 3000 설정\n        const [xboxRes, epicRes] = await Promise.allSettled([\n          axios.get(\"http://localhost:4000/api/v1/deals\", {\n            params: { platform: \"Xbox\", limit: 3000 },\n          }),\n          axios.get(\"http://localhost:4000/api/v1/deals\", {\n            params: { platform: \"Epic\", limit: 3000 },\n          }),\n        ]);\n\n        const xboxData =\n          xboxRes.status === \"fulfilled\" ? xboxRes.value.data.data : [];\n        const epicData =\n          epicRes.status === \"fulfilled\" ? epicRes.value.data.data : [];\n        const allDeals: Deal[] = [...xboxData, ...epicData];\n\n        // 카테고리별 필터링 로직\n        let targetDeals: Deal[] = [];\n        if (category === \"free\") {\n          // 무료 배포: 가격 0원 or Epic Free Keep (Xbox 구독 제외)\n          targetDeals = allDeals.filter(\n            (d) =>\n              (d.sale_price === 0 || d.epicMeta?.is_free_to_keep) &&\n              !d.platform.includes(\"Xbox\")\n          );\n        } else if (category === \"sale\") {\n          // 할인: 정가 > 판매가\n          targetDeals = allDeals.filter(\n            (d) => d.regular_price > d.sale_price && d.sale_price > 0\n          );\n        } else if (category === \"sub\") {\n          // 구독: Xbox (또는 추후 PS Plus 등)\n          targetDeals = allDeals.filter(\n            (d) => d.platform.includes(\"Xbox\") || d.deal_type === \"GamePass\"\n          );\n        }\n\n        setDeals(targetDeals);\n      } catch (error) {\n        console.error(\"데이터 로드 실패\", error);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchData();\n  }, [category]);\n\n  // --- 3. 검색 및 정렬 (한글 우선) ---\n  const filteredDeals = useMemo(() => {\n    let result = deals.filter((deal) =>\n      deal.title.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    if (sortOrder === \"az\") {\n      result.sort((a, b) => {\n        const titleA = a.title;\n        const titleB = b.title;\n        const isKoA = /[가-힣]/.test(titleA.charAt(0));\n        const isKoB = /[가-힣]/.test(titleB.charAt(0));\n\n        if (isKoA === isKoB) {\n          return titleA.localeCompare(titleB, \"ko-KR\", { numeric: true });\n        }\n        return isKoA ? -1 : 1;\n      });\n    }\n    return result;\n  }, [deals, searchTerm, sortOrder]);\n\n  const getImageSrc = (deal: Deal) => deal.image_url || \"/default_thumb.png\";\n\n  // --- 4. 렌더링 헬퍼 (메인 대시보드와 동일한 로직) ---\n\n  // 가격/구독 정보 표시\n  const renderPriceOrInfo = (deal: Deal) => {\n    if (deal.xboxMeta) {\n      return (\n        <div className=\"flex flex-col items-start gap-0.5\">\n          <span className=\"text-xs font-extrabold text-green-700 uppercase\">\n            {deal.xboxMeta.game_pass_tier.replace(/,/g, \" · \")}\n          </span>\n          <span className=\"text-[10px] text-gray-500 truncate max-w-full\">\n            Xbox Console · PC\n          </span>\n        </div>\n      );\n    }\n    return (\n      <div className=\"flex flex-col items-start\">\n        {deal.regular_price > deal.sale_price && deal.regular_price > 0 && (\n          <span className=\"text-[10px] text-gray-400 line-through\">\n            ₩{deal.regular_price.toLocaleString()}\n          </span>\n        )}\n        <span className=\"text-blue-600 font-bold text-sm\">\n          {deal.sale_price === 0\n            ? \"무료\"\n            : `₩${deal.sale_price.toLocaleString()}`}\n        </span>\n      </div>\n    );\n  };\n\n  // 배지 표시\n  const renderBadges = (deal: Deal) => {\n    if (deal.xboxMeta?.is_day_one) {\n      return (\n        <span className=\"px-1.5 py-0.5 text-[9px] font-bold text-black bg-yellow-400 rounded\">\n          Day 1\n        </span>\n      );\n    }\n    if (deal.epicMeta?.is_free_to_keep) {\n      return (\n        <span className=\"px-1.5 py-0.5 text-[9px] font-bold text-white bg-blue-600 rounded\">\n          Free Keep\n        </span>\n      );\n    }\n    if (deal.discount_rate > 0) {\n      return (\n        <span className=\"px-1.5 py-0.5 text-[9px] font-bold text-white bg-red-600 rounded\">\n          -{deal.discount_rate}%\n        </span>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <main className=\"max-w-7xl mx-auto px-4 md:px-8 py-8 min-h-screen\">\n      {/* --- 상단 컨트롤러 --- */}\n      <div className=\"flex flex-col md:flex-row justify-between items-end mb-8 gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-extrabold text-gray-900 mb-2\">\n            {title}\n          </h1>\n          <p className=\"text-gray-500 text-sm\">\n            총{\" \"}\n            <span className=\"font-bold text-gray-900\">\n              {filteredDeals.length}\n            </span>\n            개의 게임을 찾았습니다.\n          </p>\n        </div>\n\n        <div className=\"flex flex-col sm:flex-row gap-3 w-full md:w-auto\">\n          <input\n            type=\"text\"\n            placeholder=\"게임 제목 검색...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"flex-1 md:w-64 px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gray-900 outline-none transition-shadow\"\n          />\n          <select\n            value={sortOrder}\n            onChange={(e: any) => setSortOrder(e.target.value)}\n            className=\"px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gray-900 outline-none bg-white cursor-pointer\"\n          >\n            <option value=\"az\">가나다순 (A-Z)</option>\n          </select>\n        </div>\n      </div>\n\n      {/* --- 메인 그리드 영역 --- */}\n      {loading ? (\n        <div className=\"flex justify-center py-32\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900\"></div>\n        </div>\n      ) : filteredDeals.length === 0 ? (\n        <div className=\"text-center py-32 border-2 border-dashed border-gray-200 rounded-xl bg-gray-50\">\n          <p className=\"text-gray-500\">조건에 맞는 게임이 없습니다.</p>\n        </div>\n      ) : (\n        // [수정됨] 반응형 그리드 설정 (모바일 2열 ~ 데스크탑 5열)\n        // gap-y-8로 행 간격을 넓혀 가독성을 높였습니다.\n        <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-x-5 gap-y-8\">\n          {filteredDeals.map((deal) => (\n            <div\n              key={deal.id}\n              className=\"group bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-all duration-300 flex flex-col w-full\"\n            >\n              {/* 이미지 영역 */}\n              <div className=\"relative w-full aspect-[16/9] bg-gray-200\">\n                <Image\n                  src={getImageSrc(deal)}\n                  alt={deal.title}\n                  fill\n                  className=\"object-cover group-hover:scale-105 transition-transform duration-300\"\n                  unoptimized\n                />\n                {/* 플랫폼 라벨 (좌상단) */}\n                <div className=\"absolute top-2 left-2 bg-black/70 backdrop-blur-md text-white text-[9px] font-bold px-1.5 py-0.5 rounded uppercase\">\n                  {deal.platform.includes(\"Xbox\") ? \"Xbox\" : deal.platform}\n                </div>\n              </div>\n\n              {/* 텍스트 정보 영역 */}\n              <div className=\"p-3 flex flex-col h-[140px]\">\n                <h4 className=\"text-sm font-bold text-gray-900 leading-tight line-clamp-2 mb-1 h-10 group-hover:text-blue-600 transition-colors\">\n                  {deal.title}\n                </h4>\n\n                <div className=\"mt-auto\">\n                  <div className=\"mb-2 min-h-[40px] flex flex-col justify-end\">\n                    <div className=\"flex justify-between items-end w-full\">\n                      {renderPriceOrInfo(deal)}\n                      {renderBadges(deal)}\n                    </div>\n                  </div>\n\n                  <a\n                    href={deal.url}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"block w-full text-center bg-gray-100 hover:bg-gray-200 text-gray-800 text-xs font-bold py-1.5 rounded transition-colors\"\n                  >\n                    {deal.xboxMeta ? \"플레이 하기\" : \"스토어 이동\"}\n                  </a>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}